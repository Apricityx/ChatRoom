<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #main_container {
            height: 97vh;
            display: grid;
            grid-template-rows: 9fr 2fr;
        }

        * {
            border: black 1px solid;
        }

        #nickname {
            width: 100px;
        }

        #message {
            width: 97vw;
            height: 7vh;
        }

        #send {
            width: 97vw;
            height: 7vh;
        }
    </style>
</head>

<body>
<div id="main_container">
    <div id="message_container">

    </div>
    <div id="send_container">
        <input type="text" name="name" placeholder="请输入昵称" id="nickname">
        <br>
        <input type="text" name="age" placeholder="请输入消息" id="message">
        <button id="send" onclick="sendHandler()">发送</button>
    </div>
</div>

</body>
<script>
    let chat_container = document.getElementById("message_container")
    // Create WebSocket connection.
    const socket = new WebSocket("ws://localhost:8765");

    // Connection opened
    socket.addEventListener("open", function (event) {
        socket.send(JSON.stringify({method: "ping", pullNum: 15, message: "hello"}));
        getChat(15)
    });

    // Listen for messages
    socket.addEventListener("message", function (event) {
        console.log("Message from server ", event.data);
        let message = JSON.parse(event.data)
        if (message.method === "push") {
            for (let i = 0; i < message.data.length; i++) {
                let chat = document.createElement("div")
                chat.innerHTML = message.data[i].nickname + ": " + message.data[i].message
                chat_container.appendChild(chat)
            }
        }
    });
</script>
<script>
    const api_url = "localhost"

    function getChat(num) {
        let get_message = {
            "method": "pull",
            "pullNum": num
        }
        console.log("尝试获取消息")
        socket.send(JSON.stringify(get_message))
    }

    function sendHandler() {
        let nickname = document.getElementById("nickname").value
        let message = document.getElementById("message").value
        const data = {nickname: nickname, message: message};
    }
</script>
<script>
</script>
</html>